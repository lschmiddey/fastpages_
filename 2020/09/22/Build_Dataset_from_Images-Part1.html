<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Teach Python how to read | Data Science Blog von lschmiddey</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Teach Python how to read" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html" />
<meta property="og:url" content="https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html" />
<meta property="og:site_name" content="Data Science Blog von lschmiddey" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-22T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-09-22T00:00:00-05:00","headline":"Teach Python how to read","mainEntityOfPage":{"@type":"WebPage","@id":"https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html"},"@type":"BlogPosting","url":"https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html","dateModified":"2020-09-22T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/fastpages_/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://lschmiddey.github.io/fastpages_/feed.xml" title="Data Science Blog von lschmiddey" /><link rel="shortcut icon" type="image/x-icon" href="/fastpages_/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Teach Python how to read | Data Science Blog von lschmiddey</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Teach Python how to read" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html" />
<meta property="og:url" content="https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html" />
<meta property="og:site_name" content="Data Science Blog von lschmiddey" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-22T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-09-22T00:00:00-05:00","headline":"Teach Python how to read","mainEntityOfPage":{"@type":"WebPage","@id":"https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html"},"@type":"BlogPosting","url":"https://lschmiddey.github.io/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html","dateModified":"2020-09-22T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://lschmiddey.github.io/fastpages_/feed.xml" title="Data Science Blog von lschmiddey" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/fastpages_/">Data Science Blog von lschmiddey</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fastpages_/about/">About Me</a><a class="page-link" href="/fastpages_/search/">Search</a><a class="page-link" href="/fastpages_/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Teach Python how to read</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-09-22T00:00:00-05:00" itemprop="datePublished">
        Sep 22, 2020
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      9 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/lschmiddey/fastpages_/tree/master/_notebooks/2020-09-22-Build_Dataset_from_Images-Part1.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/fastpages_/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/lschmiddey/fastpages_/master?filepath=_notebooks%2F2020-09-22-Build_Dataset_from_Images-Part1.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fastpages_/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/lschmiddey/fastpages_/blob/master/_notebooks/2020-09-22-Build_Dataset_from_Images-Part1.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fastpages_/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-09-22-Build_Dataset_from_Images-Part1.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-PIL-and-pytesseract">Using PIL and pytesseract<a class="anchor-link" href="#Using-PIL-and-pytesseract"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is the first blogpost of a three to four (I haven't decided yet) part project. The main idea is that I want to create a model which will tell me how much I would like the book, given an image of a page as in input.</p>
<p>In this part, I will show you how to turn a image of text into actual text, using pytesseract. So let's first get our packages.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Import-packages">Import packages<a class="anchor-link" href="#Import-packages"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>apt-get update
<span class="o">!</span>apt-get install libleptonica-dev -y
<span class="o">!</span>apt-get install tesseract-ocr tesseract-ocr-dev -y
<span class="o">!</span>apt-get install libtesseract-dev -y
<span class="o">!</span>apt-get install tesseract-ocr-deu
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Ign:1 http://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64  InRelease
Hit:2 http://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64  Release
Hit:3 http://security.ubuntu.com/ubuntu xenial-security InRelease              
Ign:5 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64  InRelease
Hit:6 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64  Release
Hit:7 http://archive.ubuntu.com/ubuntu xenial InRelease
Hit:9 http://archive.ubuntu.com/ubuntu xenial-updates InRelease
Hit:10 http://archive.ubuntu.com/ubuntu xenial-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree       
Reading state information... Done
libleptonica-dev is already the newest version (1.73-1).
0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.
Reading package lists... Done
Building dependency tree       
Reading state information... Done
tesseract-ocr is already the newest version (3.04.01-4).
tesseract-ocr-dev is already the newest version (3.04.01-4).
0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.
Reading package lists... Done
Building dependency tree       
Reading state information... Done
libtesseract-dev is already the newest version (3.04.01-4).
0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  tesseract-ocr-deu
0 upgraded, 1 newly installed, 0 to remove and 39 not upgraded.
Need to get 4153 kB of archives.
After this operation, 13.4 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu xenial/universe amd64 tesseract-ocr-deu all 3.04.00-1 [4153 kB]
Fetched 4153 kB in 1s (2333 kB/s)            
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package tesseract-ocr-deu.
(Reading database ... 18655 files and directories currently installed.)
Preparing to unpack .../tesseract-ocr-deu_3.04.00-1_all.deb ...
Unpacking tesseract-ocr-deu (3.04.00-1) ...
Setting up tesseract-ocr-deu (3.04.00-1) ...
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install pytesseract
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Requirement already satisfied: pytesseract in /opt/conda/envs/fastai/lib/python3.8/site-packages (0.3.6)
Requirement already satisfied: Pillow in /opt/conda/envs/fastai/lib/python3.8/site-packages (from pytesseract) (7.2.0)
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai.vision.widgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pytesseract</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageFilter</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-PosixPath-to-data">Define PosixPath to data<a class="anchor-link" href="#Define-PosixPath-to-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I took about 100 images of pages from books I own (all in German). I then put them in an image folder, let's have a look at the directory.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">/</span><span class="s1">&#39;images&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;IMG_5123_gegendenStrich.jpg&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Use-regex-to-extract-title-of-book">Use regex to extract title of book<a class="anchor-link" href="#Use-regex-to-extract-title-of-book"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next to the text from the image, I would like to extract the title of the book so I can later easily join my ratings to the texts. I therefore use a regex.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">title_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^.*\_(.*)\..*$&quot;</span><span class="p">,</span><span class="n">img_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img_paths</span><span class="p">))]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Automatically-read-in-images,-transform-them-and-get-text">Automatically read in images, transform them and get text<a class="anchor-link" href="#Automatically-read-in-images,-transform-them-and-get-text"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We use pytesseract for extracting the text from the images. To improve the performance I tried a lot of data transformation: cropping, binarizing and a lot more. The only thing that worked for me was to first rotate the image and then use a MedianFilter.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">proc_img</span><span class="p">(</span><span class="n">img_path</span><span class="p">):</span>
    <span class="n">im1</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span> 

    <span class="n">im1</span> <span class="o">=</span> <span class="n">im1</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">im1</span> <span class="o">=</span> <span class="n">im1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ImageFilter</span><span class="o">.</span><span class="n">MedianFilter</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">im1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All of my input images are from german books, so I need to use lang="deu".</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;deu&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I again use a regular expression to get rid of common mistakes pytesseract does: putting a \n somewhere or confusing a s for a 5.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">use_pattern</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">rep</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))],</span> <span class="n">text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rep</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;`&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;Â°&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;â€˜&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;â‚¬&#39;</span><span class="p">:</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;Â®&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span> <span class="c1"># define desired replacements here</span>

<span class="c1"># use these three lines to do the replacement</span>
<span class="n">rep</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rep</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> 
<span class="c1">#Python 3 renamed dict.iteritems to dict.items so use rep.items() for latest versions</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rep</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Use-tesseract-to-make-image-into-text">Use tesseract to make image into text<a class="anchor-link" href="#Use-tesseract-to-make-image-into-text"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we use a list comprehension (they're super useful) to put all of the text into a list of texts.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">text_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">use_pattern</span><span class="p">(</span><span class="n">get_text</span><span class="p">(</span><span class="n">proc_img</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">img_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img_paths</span><span class="p">))]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Combine-into-Dataframe">Combine into Dataframe<a class="anchor-link" href="#Combine-into-Dataframe"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And now let's put that into a pandas dataframe.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="n">text_list</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="n">title_list</span><span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> 
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>war ein schrecklicher RÃ¼ckfall eingetreten.In dem Â»verheirateten PriesterÂ« wurde das LobChristi von Barbey dâ€™AurÃ©villy gesungen; in Â»LesDiaboliquesÂ« hatte sich der Verfasser dem Teufel ergeben, den er pries; und jetzt erschien der Sadismus,dieser Bastard des Katholizismus, den die Religion inallen Formen mit Exorzismen und Scheiterhaufendurch alle Jahrhunderte verfolgt hat.Mit Barbey dâ€™AurÃ©villy nahm die Serie der reliâ€”giÃ¶sen Schriftsteller ein Ende. Eigentlich gehÃ¶rte dieser Paria in jeder Hinsicht mehr zur weltlichen Liteâ€”ratur als zu jener andern, bei der er einen Platzbeanspruchte, den...</td>
      <td>gegendenStrich</td>
    </tr>
    <tr>
      <th>1</th>
      <td>hÃ¶chst moralischer Akt, die Welt von einem solchen Ungeheuerzu befreien? Die Menschheit wÃ¤re dann besser und glÃ¼cklicherund das Leben schÃ¶ner und sÃ¼ÃŸer.Ich dachte lange darÃ¼ber nach. Schlaï¬‚os lag ich in meinerKoj e und hielt mir die Fakten vor Augen. Mit Johnson und Leachredete ich wÃ¤hrend der Nachtwachen, wenn Wolf Larsen unterDeck war. Beide MÃ¤nner hatten die Hoffnung verloren â€” Johnson wegen seiner grundlegenden Schwermut, Leach, weil ersich in seinen vergeblichen KÃ¤mpfen erschÃ¶pft hatte. Aber eines Nachts ergriff er leidenschaftlich meine Hand und sagte:Â»Ich glaube, Sie sind in Ordnung...</td>
      <td>derSeewolf</td>
    </tr>
    <tr>
      <th>2</th>
      <td>deutsches Luder nehmen. Und sollten Sie es dann allzu eilighaben, Mr. Andrews, werden Sie mich wohl von ihr runterziehen mÃ¼ssen.Â«Andrews wartete, dass die beiden MÃ¤nner fortritten, undsah ihnen nach, wie sie sich durch das dÃ¤mmrige Tal entfernâ€”ten und ihre auf und ab wippenden Gestalten mit der dunkleren Schraffur der westlichen BerghÃ¤nge verschmelzen. Dannaufs Neue Ã¼berraschte, lenkte die HÃ¤nde ab und sorgte dafÃ¼r,dass ihm die eigenen GesichtszÃ¼ge fremd vorkamen; er fragtesich, wie er wohl aussah, fragte sich, ob Francine ihn wiederkennen wÃ¼rde, wenn sie ihn jetzt sehen kÃ¶nnte.Seit dem Ab...</td>
      <td>ButchersCrossing</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Doktor, das wissen Sie so gut wie ich. Vor hundert Jahâ€”ren hat eine Pestepidemie in Persien alle Bewohner einerStadt getÃ¶tet und ausgerechnet den TotenwÃ¤scher nicht,der nie aufgehÃ¶rt hatte, seine Arbeit zu verrichten.Â»mÃ¼ssen.Â»Sie kamen jetzt in die Vorstadt. Die Scheinwerfer beleuchteten die menschenleeren StraÃŸen. Sie hielten an.Vor dem Auto fragte Rieux Tarrou, ob er mitkommenwolle, und der sagte ja. Ein Schimmer vom Himmel erâ€”hellte ihre Gesichter. Rieux lachte plÃ¶tzlich freundschaftlich.Â« Sagen Sie, Tarrou, was treibt Sie dazu, sich damit zubefassen? Â»&lt;&lt; Ich weiÃŸ nicht. Meine Moral vie...</td>
      <td>diePest</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ins Gesicht, wandte sich von ihrem traurigen Ausdruckangewidert ab, und nachdem er zum hundertsten Maldie AushÃ¤ngeschilder der gegenÃ¼berliegenden GeschÃ¤fte, die Werbung fÃ¼r die schon nicht mehr erhÃ¤ltâ€”lichen bekannten Aperitifmarken gelesen hatte, stander auf und lief ziellos durch die gelben StraÃŸen derStadt. Er schleppte sich von einsamen SpaziergÃ¤ngen inCafÃ©s und von CafÃ©s in Restaurants und erreichte soden Abend. An einem solchen Abend sah Rieux denJournalisten zÃ¶gernd vor der TÃ¼r eines CafÃ©s stehen. Erschien sich zu entschlieÃŸen, ging hinein und setzte sichhinten hin. Es war um die Ze...</td>
      <td>diePest</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Doktor, das wissen Sie so gut wie ich. Vor hundert Jahâ€”ren hat eine Pestepidemie in Persien alle Bewohner einerStadt getÃ¶tet und ausgerechnet den TotenwÃ¤scher nicht,der nie aufgehÃ¶rt hatte, seine Arbeit zu verrichten.Â»mÃ¼ssen.Â»Sie kamen jetzt in die Vorstadt. Die Scheinwerfer beleuchteten die menschenleeren StraÃŸen. Sie hielten an.Vor dem Auto fragte Rieux Tarrou, ob er mitkommenwolle, und der sagte ja. Ein Schimmer vom Himmel erâ€”hellte ihre Gesichter. Rieux lachte plÃ¶tzlich freundschaftlich.Â« Sagen Sie, Tarrou, was treibt Sie dazu, sich damit zubefassen? Â»&lt;&lt; Ich weiÃŸ nicht. Meine Moral vielleicht.Â»Â«Und die wÃ¤re? &gt;&gt;Â«VerstÃ¤ndnis.Â»Tarrou wandte sich dem Haus zu, und Rieux sah erstwieder sein Gesicht, als sie bei dem alten Asthmatikerwaren.&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking good! For this project I also need my ratings for each of the books. I use a dictionary and the map function to easily create a column with my ratings.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Use-Dictionary-to-map-my-ratings">Use Dictionary to map my ratings<a class="anchor-link" href="#Use-Dictionary-to-map-my-ratings"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rating_lasse</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;derPate&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                 <span class="s1">&#39;ButchersCrossing&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="s1">&#39;derSeewolf&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                 <span class="s1">&#39;JekyllandHyde&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="s1">&#39;gegendenStrich&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="s1">&#39;FruestueckmitKaengurus&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                 <span class="s1">&#39;HuckleberryFinn&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="s1">&#39;diePest&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="s1">&#39;HerzderFinsternis&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                 <span class="s1">&#39;derSpieler&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">rating_lasse</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>title</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>war ein schrecklicher RÃ¼ckfall eingetreten.In dem Â»verheirateten PriesterÂ« wurde das LobChristi von Barbey dâ€™AurÃ©villy gesungen; in Â»LesDiaboliquesÂ« hatte sich der Verfasser dem Teufel ergeben, den er pries; und jetzt erschien der Sadismus,dieser Bastard des Katholizismus, den die Religion inallen Formen mit Exorzismen und Scheiterhaufendurch alle Jahrhunderte verfolgt hat.Mit Barbey dâ€™AurÃ©villy nahm die Serie der reliâ€”giÃ¶sen Schriftsteller ein Ende. Eigentlich gehÃ¶rte dieser Paria in jeder Hinsicht mehr zur weltlichen Liteâ€”ratur als zu jener andern, bei der er einen Platzbeanspruchte, den...</td>
      <td>gegendenStrich</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>hÃ¶chst moralischer Akt, die Welt von einem solchen Ungeheuerzu befreien? Die Menschheit wÃ¤re dann besser und glÃ¼cklicherund das Leben schÃ¶ner und sÃ¼ÃŸer.Ich dachte lange darÃ¼ber nach. Schlaï¬‚os lag ich in meinerKoj e und hielt mir die Fakten vor Augen. Mit Johnson und Leachredete ich wÃ¤hrend der Nachtwachen, wenn Wolf Larsen unterDeck war. Beide MÃ¤nner hatten die Hoffnung verloren â€” Johnson wegen seiner grundlegenden Schwermut, Leach, weil ersich in seinen vergeblichen KÃ¤mpfen erschÃ¶pft hatte. Aber eines Nachts ergriff er leidenschaftlich meine Hand und sagte:Â»Ich glaube, Sie sind in Ordnung...</td>
      <td>derSeewolf</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>deutsches Luder nehmen. Und sollten Sie es dann allzu eilighaben, Mr. Andrews, werden Sie mich wohl von ihr runterziehen mÃ¼ssen.Â«Andrews wartete, dass die beiden MÃ¤nner fortritten, undsah ihnen nach, wie sie sich durch das dÃ¤mmrige Tal entfernâ€”ten und ihre auf und ab wippenden Gestalten mit der dunkleren Schraffur der westlichen BerghÃ¤nge verschmelzen. Dannaufs Neue Ã¼berraschte, lenkte die HÃ¤nde ab und sorgte dafÃ¼r,dass ihm die eigenen GesichtszÃ¼ge fremd vorkamen; er fragtesich, wie er wohl aussah, fragte sich, ob Francine ihn wiederkennen wÃ¼rde, wenn sie ihn jetzt sehen kÃ¶nnte.Seit dem Ab...</td>
      <td>ButchersCrossing</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Doktor, das wissen Sie so gut wie ich. Vor hundert Jahâ€”ren hat eine Pestepidemie in Persien alle Bewohner einerStadt getÃ¶tet und ausgerechnet den TotenwÃ¤scher nicht,der nie aufgehÃ¶rt hatte, seine Arbeit zu verrichten.Â»mÃ¼ssen.Â»Sie kamen jetzt in die Vorstadt. Die Scheinwerfer beleuchteten die menschenleeren StraÃŸen. Sie hielten an.Vor dem Auto fragte Rieux Tarrou, ob er mitkommenwolle, und der sagte ja. Ein Schimmer vom Himmel erâ€”hellte ihre Gesichter. Rieux lachte plÃ¶tzlich freundschaftlich.Â« Sagen Sie, Tarrou, was treibt Sie dazu, sich damit zubefassen? Â»&lt;&lt; Ich weiÃŸ nicht. Meine Moral vie...</td>
      <td>diePest</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ins Gesicht, wandte sich von ihrem traurigen Ausdruckangewidert ab, und nachdem er zum hundertsten Maldie AushÃ¤ngeschilder der gegenÃ¼berliegenden GeschÃ¤fte, die Werbung fÃ¼r die schon nicht mehr erhÃ¤ltâ€”lichen bekannten Aperitifmarken gelesen hatte, stander auf und lief ziellos durch die gelben StraÃŸen derStadt. Er schleppte sich von einsamen SpaziergÃ¤ngen inCafÃ©s und von CafÃ©s in Restaurants und erreichte soden Abend. An einem solchen Abend sah Rieux denJournalisten zÃ¶gernd vor der TÃ¼r eines CafÃ©s stehen. Erschien sich zu entschlieÃŸen, ging hinein und setzte sichhinten hin. Es war um die Ze...</td>
      <td>diePest</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And that's it, let's save this dataframe and we're ready to move on to the model training!</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="s1">&#39;datasets/text_df.csv&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I hope you enjoyed this blogpost and stay tuned for the next one!</p>
<p>Lasse</p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/fastpages_/2020/09/22/Build_Dataset_from_Images-Part1.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fastpages_/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/fastpages_/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/fastpages_/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/lschmiddey" target="_blank" title="lschmiddey"><svg class="svg-icon grey"><use xlink:href="/fastpages_/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
